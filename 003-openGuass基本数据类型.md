## 003-openGauss基本数据类型

本笔记记录了openGauss数据库支持的基本数据类型

特此说明，本笔记没有太多技术含量，大部分来自于openGauss官方文档的搬运，仅进行了部分纠错和修改，用作学习和记忆。

由于数据库大小写不敏感，编者觉得小写字母更直观好记，因此本文档涉及的token都是小写单词。

### 数值类型

#### （1）整数类型

| 名称     | 描述               | 存储空间 | 范围                      |
| -------- | ------------------ | -------- | ------------------------- |
| tinyint  | 微整数，别名为int1，没有符号位 | 1个字节  | 0-255                     |
| smallint | 小整数，别名为int2 | 2个字节  | - 2^15^ ~2^15^-1 |
| integer | 整数，别名为int4 | 4个字节 | - 2^31^ ~2^31^-1 |
| binary_integer | integer的别名 | 4个字节 | - 2^31^ ~2^31^-1 |
| bigint | 大整数，别名为int8 | 8个字节 | - 2^63^ ~2^63^-1 |
| int16 | 十六字节的大整数，目前不支持建表用 | 16字节 | - 2^127^ ~2^127^-1 |



#### （2）任意精度型

| 名称                               | 描述                                              | 存储空间                             | 范围                                          |
| ---------------------------------- | ------------------------------------------------- | ------------------------------------ | --------------------------------------------- |
| numeric[(p[,s])]或decimal[(p[,s])] | p（总位数）取值范围为[1,1000]，s（小数位）为[0,p] | p每4位占用2个字节，整体需要额外8字节 | 小数点前最大131,072位，小数点后最大16,383位。 |
| number[(p[,s])]                    | NUMERIC的别名                                     | 同上                                 | 同上                                          |



#### （3）序列整型

| 名称     | 描述               | 存储空间 | 范围                      |
| -------- | ------------------ | -------- | ------------------------- |
| smallserial | 2字节序列整型 | 2个字节 | - 2^15^ ~2^15^-1     |
| serial | 4字节序列整型 | 4个字节 | - 2^31^ ~2^31^-1 |
| bigserial | 8字节序列整型 | 8个字节 | - 2^63^ ~2^63^-1 |
| largeserial | 16字节序列整型 | 16个字节 | - 2^127^ ~2^127^-1 |



#### （4）浮点类型

| 名称                     | 描述                    | 存储空间   | 范围                    |
| ------------------------ | ----------------------- | ---------- | ----------------------- |
| real或float4             | 单精度浮点数            | 4个字节    | -3.402E+38~3.402E+38    |
| double precision或float8 | 双精度浮点数            | 8个字节    | -1.79E+308~1.79E+308    |
| float[(p)]               | 浮点数，p取值范围[1,53] | 4或8个字节 | 视p取real或double的范围 |
| binary_double            | double precision的别名  | 8个字节    | 同double的范围          |
| dec[(p[,s])]             | 同numeric               | 同numeric  | 同numeric               |
| integer[(p[,s])]         | 同numeric               | 同numeric  | 同numeric               |



### 布尔类型

| 名称    | 描述     | 存储空间 | 取值                         |
| ------- | -------- | -------- | ---------------------------- |
| boolean | 布尔类型 | 1个字节  | true:真；false:假；null:未知 |



### 字符类型

#### （1） 字符类型

| 名称                             | 描述                                | 存储空间                                                |
| -------------------------------- | ----------------------------------- | ------------------------------------------------------- |
| char(n)或character(n)或nchar(n)  | 定长字符串，不足补空格，默认精度为1 | 最小1字节，最大10MB                                     |
| varchar(n)或character varying(n) | 变长字符串，不补空格，n指最大字节数 | 最大10MB                                                |
| varchar2(n)                      | varchar的别名                       | 最大10MB                                                |
| nvarchar2(n)                     | 变长字符串，n指最大字节数           | 最大10MB                                                |
| text                             | 文本大对象                          | 最大为1GB-1，但还是需要考虑列描述头的大小和元组大小限制 |
| clob                             | text的别名                          | 同上                                                    |

- 除了每列的大小限制以外，每个元组的总大小也不可超过1GB-1字节，主要受列的控制头信息、元组控制头信息以及元组中是否存在NULL字段等影响。
- NCHAR为bpchar类型的别名，NCHAR(n)为b(n)类型bpchar(n)的别名。？



#### （2）特殊字符类型

| 名称   | 描述                 | 存储空间 |
| ------ | -------------------- | -------- |
| name   | 用于对象名的内部类型 | 64字节   |
| "char" | 单字节内部类型       | 1字节    |

- name类型只用在内部系统表中，作为存储标识符，不建议普通用户使用。该类型长度当前定为64字节（63可用字符加结束符）
- 类型“char”只用了一个字节的存储空间。他在系统内部主要用于系统表，主要作为简单化的枚举类型使用



### 二进制类型

| 名称                           | 描述                                                         | 存储空间            |
| ------------------------------ | ------------------------------------------------------------ | ------------------- |
| blob                           | 二进制大对象：列存不支持                                     | 最大1GB-8203字节    |
| raw                            | 变长16进制：列存不支持                                       | 最大1GB-8203字节    |
| bytea                          | 变长2进制                                                    | 最大1GB-8203字节    |
| byteawithoutorderwithequalcol  | 变长的二进制字符串（密态特性新增的类型，如果加密列的加密类型指定为确定性加密），元命令打印加密表将显示原始数据类型 | 最大为1GB减去53字节 |
| byteawithoutordercol           | 变长的二进制字符串（密态特性新增的类型，如果加密列的加密类型指定为随机加密），元命令打印加密表将显示原始数据类型 | 最大为1GB减去53字节 |
| _byteawithoutorderwithequalcol | 变长的二进制字符串（密态特性新增的类型)                      | 最大为1GB减去53字节 |
| _byteawithoutordercol          | 变长的二进制字符串（密态特性新增的类型)                      | 最大为1GB减去53字节 |

> - 除了每列的大小限制以外，每个元组的总大小也不可超过1GB-8203字节（即1073733621字节）。
> - 不支持直接使用BYTEAWITHOUTORDERWITHEQUALCOL和BYTEAWITHOUTORDERCOL，_BYTEAWITHOUTORDERWITHEQUALCOL，_BYTEAWITHOUTORDERCOL类型创建表。



### 日期时间类型

| 名称                               | 描述                                                         | 存储空间                     |
| ---------------------------------- | ------------------------------------------------------------ | ---------------------------- |
| date                               | 日期和时间                                                   | 4字节（实际8字节）？？咩意思 |
| time[(p)]\[without time zone]      | 一日内时间，p表示小数点后的精度，取值范围为0~6               | 8字节                        |
| time[(p)]\[without time zone]      | 一日内时间，带时区                                           | 12字节                       |
| timestamp[(p)] [without time zone] | 日期和时间，p表示小数点后的精度，取值范围为0~6               | 8字节                        |
| timestamp[(p)] [with time zone]    | 日期和时间，带时区                                           | 8字节                        |
| smalldatetime                      | 日期和时间，不带时区。精确到分钟，秒位大于等于30秒进一位。   | 8字节                        |
| interval day(l) tosecond(p)        | 时间间隔，x天x小时x分x秒，l:天数精度（0~6），p秒数精度（0~6） | 16字节                       |
| interval [fields] [(p)]            | 时间间隔，field：可以是year，month，day，hour，minute，second，day to hour/minute/second，hout to minute/second，minute to second，p：秒数精度（0~6）只有file带second才有效 | 12字节                       |
| reltime                            | 相对时间间隔，X years X mons X days XX:XX:XX，采用儒略历计时，规定一年为365.25天，一个月为30天，计算输入值对应的相对时间间隔，输出采用postgres格式 | 4字节                        |
| abstime                            | 日期和时间。格式为：YYYY-MM-DD hh:mm:ss+timezone，取值范围为1901-12-13 20:45:53 GMT~2038-01-18 23:59:59 GMT，精度为秒。 | 4字节                        |



### 几何类型

| 名称    | 说明                     | 表现形式                 | 存储空间   |
| ------- | ------------------------ | ------------------------ | ---------- |
| point   | 平面中的点               | (x,y)                    | 16字节     |
| lseg    | （有限）线段             | ((x1,y1),(x2,y2))        | 32字节     |
| box     | 矩形                     | ((x1,y1),(x2,y2))        | 32字节     |
| path    | 闭合路径（与多边形类似） | ((x1,y1),...)            | 16+16n字节 |
| path    | 开放路径                 | [(x1,y1),...]            | 16+16n字节 |
| polygon | 多边形（与闭合路径相似） | ((x1,y1),...)            | 40+16n字节 |
| circle  | 圆                       | <(x,y),r> （圆心和半径） | 24 字节    |



### 网络地址类型

| 名称    | 描述                 | 存储空间  |
| :------ | :------------------- | :-------- |
| cidr    | IPv4或IPv6网络       | 7或19字节 |
| inet    | IPv4或IPv6主机和网络 | 7或19字节 |
| macaddr | MAC地址              | 6字节     |

在对inet或cidr数据类型进行排序的时候，IPv4地址总是排在IPv6地址前面，

- cidr（无类别域间路由，Classless Inter-Domain Routing）类型，保存一个IPv4或IPv6网络地址。声明网络格式为address/y，address表示IPv4或者IPv6地址，y表示子网掩码的二进制位数。如果省略y，则掩码部分使用已有类别的网络编号系统进行计算，但要求输入的数据已经包括了确定掩码所需的所有字节。
- inet类型在一个数据区域内保存主机的IPv4或IPv6地址，以及一个可选子网。主机地址中网络地址的位数表示子网（“子网掩码”）。如果子网掩码是32并且地址是IPv4，则这个值不表示任何子网，只表示一台主机。在IPv6里，地址长度是128位，因此128位表示唯一的主机地址。
- macaddr类型存储MAC地址，也就是以太网卡硬件地址（尽管MAC地址还用于其它用途）



### 位串类型

| 名称           | 描述                                                         | 存储空间    |
| :------------- | :----------------------------------------------------------- | :---------- |
| bit(n)         | 一串1和0的定长字符串，长度为n（不填默认为1），可以用于存储位掩码， | n bit       |
| bit varying(n) | 一串1和0的变长字符串，最大长度为n（不填则长度限制），可以用于存储位掩码 | n bit或无限 |



### 文本搜索类型

| 名称     | 描述                                                         | 存储空间     |
| :------- | :----------------------------------------------------------- | :----------- |
| tsvector | 表、文档的字符串信息转化成的token的有序列表（转换时去重和排序） | 取决于字符串 |
| tsquery  | 也用于文本搜索条件，支持布尔操作符& \| !进行条件的组合       | 取决于字符串 |

- tsvector作为一个搜索条件时经常配合to_tsvector一起使用
- to_tsquery函数及plainto_tsquery函数会将单词转换为tsquery类型前进行规范化处理



### uuid数据类型

| 名称 | 描述                                                         | 存储空间 |
| :--- | :----------------------------------------------------------- | :------- |
| uuid | RFC 4122，ISO/IEF 9834-8:2005以及相关标准定义的通用唯一标识符（UUID） | 16字节   |



### json、jsonb类型

JSON(JavaScript Object Notation)数据，可以是单独的一个标量，也可以是一个数组，也可以是一个键值对象，其中数组和对象可以统称容器(container)：

- 标量(scalar)：单一的数字、bool、string、null都可以叫做标量。
- 数组(array)：[]结构，里面存放的元素可以是任意类型的JSON，并且不要求数组内所有元素都是同一类型。
- 对象(object)：{}结构，存储key:value的键值对，其键只能是用“”包裹起来的字符串，值可以是任意类型的JSON，对于重复的键，按最后一个键值对为准。

其中JSON是对输入的字符串的完整拷贝，使用时再去解析，所以它会保留输入的空格、重复键以及顺序等；JSONB解析输入后保存的二进制，它在解析时会删除语义无关的细节和重复的键，对键值也会进行排序，使用时不用再次解析。

JSON数据类型存储输入文本的精确拷贝，处理函数必须在每个执行上重新解析； 而JSONB数据以分解的二进制格式存储， 这使得它由于添加了转换机制而在输入上稍微慢些，但是在处理上明显更快， 因为不需要重新解析。同时由于JSONB类型存在解析后的格式归一化等操作，同等的语义下只会有一种格式，因此可以更好更强大的支持很多其他额外的操作，比如按照一定的规则进行大小比较等。JSONB也支持索引，这也是一个明显的优势。

| 名称  | 描述                                                         | 存储空间     |
| :---- | :----------------------------------------------------------- | :----------- |
| json  | 保留格式的json串，解析开销大                                 | 取决于json串 |
| jsonb | 解析后的二进制串，去空格去无效key然后排序元素，存储代价小，不需要解析，可以索引，不支持列存 | 取决于json串 |



### hll数据类型

HLL（HyperLoglog）是统计数据集中唯一值个数的高效近似算法。它有着计算速度快、节省空间的特点，不需要直接存储集合本身，而是存储一种名为HLL的数据结构。每当有新数据加入进行统计时，只需要把数据经过哈希计算并插入到HLL中，最后根据HLL就可以得到结果。

| 名称 | 描述                         | 存储空间                                            |
| :--- | :--------------------------- | :-------------------------------------------------- |
| hll  | 保留格式的json串，解析开销大 | hll头部为27字节长度字段，默认规格下数据段长度0~16KB |



### 范围类型

某种元素类型（称为范围的_subtype_）的一个值的范围的数据类型

范围类型非常有用，因为它们可以表达一种单一范围值中的多个元素值，并且可以很清晰地表达诸如范围重叠等概念。用于时间安排的时间和日期范围是最清晰的例子；但是价格范围、一种仪器的量程等等也都有用。

| 名称      | 说明                       | 表现形式                                                     | 存储空间 |
| --------- | -------------------------- | ------------------------------------------------------------ | -------- |
| int4range | integer的范围              | (lb,ub)  (lb,ub]  [lb,ub)  [lb,ub]  empty 必须遵循其中模式之一 | ？       |
| int8range | bigint的范围               | 同上                                                         |          |
| numrange  | numeric的范围              | 同上                                                         |          |
| tsrange   | 不带时区的 timestamp的范围 | 同上                                                         |          |
| tstzrange | 带时区的 timestamp的范围   | 同上                                                         |          |
| daterange | date的范围                 | 同上                                                         |          |



### 索引

| 名称    | 描述                                                         | 存储空间       |
| :------ | :----------------------------------------------------------- | :------------- |
| gist    | 可以加速涉及以下范围操作符的查询： =、 &&、 <@、 @>、 «、 >>、 - | 取决于数据结构 |
| sp-gist | 同上                                                         | 取决于数据结构 |



### 对象标识符类型

| 名称          | 引用         | 描述                                                         | 示例                                |
| :------------ | :----------- | :----------------------------------------------------------- | :---------------------------------- |
| OID           | -            | 数字化的对象标识符。                                         | 564182                              |
| CID           | -            | 命令标识符。它是系统字段cmin和cmax的数据类型。命令标识符是32位的量。 | -                                   |
| XID           | -            | 事务标识符。它是系统字段xmin和xmax的数据类型。事务标识符也是64位的量。 | -                                   |
| TID           | -            | 行标识符。它是系统表字段ctid的数据类型。行ID是一对数值（块号，块内的行索引），它标识该行在其所在表内的物理位置。 | -                                   |
| regconfig     | pg_ts_config | 文本搜索配置。                                               | english                             |
| regdictionary | pg_ts_dict   | 文本搜索字典。                                               | simple                              |
| regoper       | pg_operator  | 操作符名。                                                   | -                                   |
| regoperator   | pg_operator  | 带参数类型的操作符。                                         | *(integer,integer)或-(NONE,integer) |
| regproc       | pg_proc      | 函数名称。                                                   | sum                                 |
| regprocedure  | pg_proc      | 带参数类型的函数。                                           | sum(int4)                           |
| regclass      | pg_class     | 关系名。                                                     | pg_type                             |
| regtype       | pg_type      | 数据类型名。                                                 | integer                             |



### 伪类型

openGauss数据类型中包含一系列特殊用途的类型，这些类型按照类别被称为伪类型。伪类型不能作为字段的数据类型，但是可以用于声明函数的参数或者结果类型。

| 名称             | 描述                                           |
| :--------------- | :--------------------------------------------- |
| any              | 表示函数接受任何输入数据类型。                 |
| anyelement       | 表示函数接受任何数据类型。                     |
| anyarray         | 表示函数接受任意数组数据类型。                 |
| anynonarray      | 表示函数接受任意非数组数据类型。               |
| anyenum          | 表示函数接受任意枚举数据类型。                 |
| anyrange         | 表示函数接受任意范围数据类型。                 |
| cstring          | 表示函数接受或者返回一个空结尾的C字符串。      |
| internal         | 表示函数接受或者返回一种服务器内部的数据类型。 |
| language_handler | 声明一个过程语言调用句柄返回language_handler。 |
| fdw_handler      | 声明一个外部数据封装器返回fdw_handler。        |
| record           | 标识函数返回一个未声明的行类型。               |
| trigger          | 声明一个触发器函数返回trigger。                |
| void             | 表示函数不返回数值。                           |
| opaque           | 一个已经过时的类型，以前用于所有上面这些用途。 |



### 列存支持的数据类型

| 类别            | 数据类型                                                     | 是否支持 |
| :-------------- | :----------------------------------------------------------- | :------- |
| Numeric Types   | smallint，integer，bigint，decimal，numeric，real，double precision，smallserial，serial，bigserial，largeserial | 支持     |
| Monetary Types  | money                                                        | 支持     |
| Character Types | character varying(n), varchar(n)，character(n), char(n)，character、char，text，nvarchar2 | 支持     |
| Character Types | name                                                         | 不支持   |
| Date/Time Types | timestamp with time zone，timestamp without time zone，date，time without time zone，time with time zone，interval | 支持     |
| big object      | clob                                                         | 支持     |
| big object      | blob                                                         | 不支持   |
| other types     | ...                                                          | 不支持   |



### xml类型

| 名称 | 表现形式 |
| :--- | :------- |
| xml  | xml串    |

> - 该功能默认未开启，如需使用，需要重新使用build.sh脚本编译数据库，修改./configure配置参数，在其中加入–with-libxml参数。
> - 在执行编译之前，需要先执行yum install -y libxml2-devel，否则会有"configure: error: library 'xml2' (version >= 2.6.23) is required for XML support"的报错。
> - 在执行编译之前，需要三方库二进制文件中dependency操作系统环境/libobs/comm/lib加入到系统环境变量LD_LIBRARY_PATH中，否则会报错"libiconv.so不存在"。



### 账本hash类型

账本数据库使用HASH16数据类型来存储行级hash摘要或表级hash摘要，使用HASH32数据类型来存储全局hash摘要或者历史表校验hash。

| 名称   | 描述                                   | 存储空间 | 范围                                       |
| :----- | :------------------------------------- | :------- | :----------------------------------------- |
| hash16 | 以无符号64位整数存储。                 | 8字节    | 0 ~ +18446744073709551615                  |
| hash32 | 以包含16个的无符号整形元素数的组存储。 | 16字节   | 16个元素的无符号整形数组能够包含的取值范围 |

